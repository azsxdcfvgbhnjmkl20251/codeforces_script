name: Scala .sc Script Runner (Scala 3)

on:
  push:
    branches:
      - kotlin_
  pull_request:
    branches:
      - kotlin_

jobs:
  run-sc-scripts:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        scala-version: [3.3.1] # For Scala 3.x (future 3.13 ready)

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Setup Coursier
        uses: coursier/setup-action@v1
        with:
          jvm: temurin:21

      - name: Install Scala tools
        run: |
          cs install scala:${{ matrix.scala-version }} \
                     scalac:${{ matrix.scala-version }} \
                     scala-cli \
                     ammonite

      - name: Check versions
        run: |
          scala -version
          scalac -version
          amm --version
          scala-cli version

      - name: Prepare .sc scripts (Scala 3 syntax)
        run: |
          mkdir -p scripts
          cat > scripts/hello_scala.sc <<'EOF'
          println("Hello from Scala 3 .sc!")
          EOF

          cat > scripts/vars.sc <<'EOF'
          val x = 42
          println(s"The answer is $x")
          EOF


      - name: Run .sc with scala-cli run
        run: |
          cd scripts
          scala-cli run --scala ${{ matrix.scala-version }} hello_scala.sc
          scala-cli run --scala ${{ matrix.scala-version }} vars.sc


      - name: Run .sc code with scala-cli run
        run: |
          cat <<'EOF' | scala-cli run --scala 3.3.1 -
          println("Hello from Scala CLI in batch mode!")
          val numbers = List(1, 2, 3)
          println(s"Sum: ${numbers.sum}")
          EOF


      - name: Run .sc with Ammonite
        run: |
          cd scripts
          amm hello_scala.sc
          amm vars.sc

      - name: Run inline code with Ammonite (batch mode)
        run: |
          amm -c '
          println("""
          Hello from Ammonite batch mode!
          """)
          val numbers = List(1, 2, 3)
          println(s"Sum: ${numbers.sum}")
          '
